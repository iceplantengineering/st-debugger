# AI-ST Debugger ユーザーマニュアル

## 概要
AI-ST Debuggerは、Structured Text (ST) プログラムの分析、デバッグ、最適化を行うためのWebベースのツールです。AIを活用したコード分析機能により、潜在的な問題の特定、修正提案、パフォーマンス最適化を支援します。

## システム要件
- Node.js 18.x 以上
- npm 9.x 以上
- 最新のWebブラウザ（Chrome、Firefox、Safari、Edge）

## インストールと起動

### 1. リポジトリのクローン
```bash
git clone https://github.com/iceplantengineering/st-debugger.git
cd st-debugger
```

### 2. 依存関係のインストール
```bash
# ルートディレクトリでサーバー依存関係をインストール
npm install

# クライアントディレクトリでフロントエンド依存関係をインストール
cd src/client
npm install
cd ../..
```

### 3. 環境設定
```bash
# 環境ファイルをコピー
cp .env.example .env

# .envファイルを編集（必要に応じて）
# OPENAI_API_KEYを設定する場合（オプション）
# DEMO_MODE=trueのままでAI機能はデモモードで動作
```

### 4. アプリケーションの起動
```bash
# サーバーとクライアントを同時に起動
npm run dev

# または個別に起動
# ターミナル1: サーバー起動
npm run server:dev

# ターミナル2: クライアント起動
cd src/client && npm run dev
```

### 5. アクセス
- **フロントエンド**: http://localhost:5176
- **バックエンドAPI**: http://localhost:3001
- **APIドキュメント**: http://localhost:3001/api/docs

## デバッグ機能の使い方

### 1. プロジェクトの作成
1. ダッシュボードにアクセス（http://localhost:5176）
2. 「新規プロジェクト」ボタンをクリック
3. プロジェクト名と説明を入力
4. 「作成」ボタンをクリック

### 2. STファイルのアップロード
1. プロジェクト詳細画面で「ファイルアップロード」をクリック
2. STファイル（.st, .prg, .fnc, .fb, .txt）を選択
3. アップロード完了を確認

### 3. コード分析の実行
1. プロジェクト詳細画面で「AI分析」タブを選択
2. 分析オプションを設定：
   - **問題タイプ**: 構文エラー、論理エラー、パフォーマンス問題、安全性懸念
   - **深刻度**: CRITICAL, ERROR, WARNING, INFO
   - **対象POU**: 特定のPOUに絞り込む（オプション）
3. 「分析開始」ボタンをクリック

### 4. 分析結果の確認
1. 検出された問題一覧が表示されます
2. 各問題をクリックして詳細を確認：
   - **問題の種類**: 構文エラー、論理エラーなど
   - **深刻度**: 問題の重要度
   - **説明**: 問題の詳細な説明
   - **行番号**: 問題のあるコード行
   - **修正提案**: AIによる具体的な修正案

### 5. 修正提案の適用
1. 問題詳細画面で「修正提案」タブを選択
2. 提案された修正を確認：
   - **修正前のコード**: 問題のある元のコード
   - **修正後のコード**: 修正されたコード
   - **説明**: 修正の理由と効果
3. 「適用」ボタンで修正をコードに反映

### 6. コードの最適化
1. 「最適化」タブを選択
2. 最適化目標を選択：
   - パフォーマンス向上
   - メモリ使用量削減
   - コード可読性向上
   - 実行速度最適化
3. 「最適化実行」ボタンをクリック
4. 最適化されたコードを確認して適用

### 7. テストケースの生成
1. 「テスト」タブを選択
2. 「テストケース生成」ボタンをクリック
3. 生成されたテストケースを確認：
   - **テスト名**: テストの目的
   - **入力値**: テスト用の入力データ
   - **期待出力**: 期待される結果
   - **手順**: テスト実行手順
4. テストケースをエクスポートして実際のテスト環境で使用

## APIの直接利用

### ヘルスチェック
```bash
curl http://localhost:3001/health
```

### プロジェクト作成
```bash
curl -X POST http://localhost:3001/api/projects \
  -H "Content-Type: application/json" \
  -d '{"name": "テストプロジェクト", "description": "テスト用"}'
```

### ファイルアップロード
```bash
curl -X POST http://localhost:3001/api/files/upload \
  -F "file=@example.st" \
  -F "projectId=プロジェクトID"
```

### AI分析実行
```bash
curl -X POST http://localhost:3001/api/ai/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "projectId": "プロジェクトID",
    "options": {
      "issueTypes": ["SYNTAX_ERROR", "LOGIC_ERROR"],
      "severityLevel": ["ERROR", "WARNING"]
    }
  }'
```

## デバッグ機能の詳細

### 1. 構文解析
- STコードの構文を解析
- IEC 61131-3規格への準拠をチェック
- タイプミス、記述ミスを検出

### 2. 論理エラー検出
- IF文の条件ミス
- ループの無限ループ可能性
- 変数の未初期化使用
- デッドコードの検出

### 3. パフォーマンス分析
- 非効率なループ構造
- 不要な変数宣言
- リソースの浪費
- 実行時間のボトルネック

### 4. 安全性チェック
- 緊急停止の欠如
- 安全インターロックの不備
- 範囲外アクセスの可能性
- 競合状態の検出

### 5. 依存関係分析
- POU間の依存関係を可視化
- 循環依存の検出
- 未使用の変数や関数を特定

## トラブルシューティング

### サーバーが起動しない場合
1. ポート3001が使用中でないか確認
```bash
netstat -an | findstr :3001
```

2. Node.jsのバージョンを確認
```bash
node --version
```

3. 依存関係を再インストール
```bash
npm install
```

### クライアントが起動しない場合
1. ポート5176が使用中でないか確認
2. クライアント依存関係を再インストール
```bash
cd src/client
npm install
```

### AI分析が機能しない場合
1. デモモードが有効になっているか確認
2. OPENAI_API_KEYを設定する場合：
   - .envファイルに有効なAPIキーを設定
   - DEMO_MODE=falseに変更
3. インターネット接続を確認

### ファイルアップロードが失敗する場合
1. ファイルサイズが50MB以下であるか確認
2. サポートされているファイル形式であるか確認（.st, .prg, .fnc, .fb, .txt）
3. アップロードディレクトリの権限を確認

## 高度な機能

### 1. バージョン管理
- プロジェクトのバージョン作成
- 過去のバージョンとの比較
- バージョン間の差分表示

### 2. エクスポート機能
- プロジェクト全体のエクスポート
- 分析結果のレポート出力
- 修正提案のドキュメント化

### 3. インポート機能
- 既存プロジェクトのインポート
- 過去の分析結果の復元
- バックアップからのリストア

### 4. 履歴管理
- 分析履歴の表示
- 修正履歴の追跡
- 変更のタイムライン

## ベストプラクティス

### 1. 効率的な分析
- 大規模なプロジェクトはPOU単位で分析
- 分析前に不要なファイルを除外
- 適切な深刻度レベルを設定

### 2. 修正の適用
- 修正前に必ずバックアップを作成
- 小さな修正から段階的に適用
- 修正後は必ずテストを実行

### 3. チームでの利用
- プロジェクトを共有して協業
- 分析結果をレビューして議論
- 標準的なコーディング規約を適用

## サポートとフィードバック

### 問題報告
- GitHubのIssuesページで問題を報告
- エラーメッセージと再現手順を詳細に記載
- 使用環境（OS、ブラウザ、Node.jsバージョン）を明記

### 機能要望
- 新機能の要望をGitHubのIssuesで提案
- 使用事例と具体的な要件を記載
- 優先度と影響範囲を説明

### ドキュメント
- 最新のドキュメントはGitHub Wikiで確認
- APIドキュメントは `/api/docs` で参照
- サンプルコードは `examples/` ディレクトリに格納

## ライセンス
本プロジェクトはMITライセンスの下で提供されています。詳細はLICENSEファイルを参照してください。

## 更新履歴
- v1.0.0: 初版リリース
- v1.1.0: AI分析機能の強化
- v1.2.0: バージョン管理機能の追加
- v1.3.0: UI/UXの改善